#!ipxe

# Arch Linux Local Boot Script
# Using local server: http://192.168.0.120:8000/

# Set architecture
set os_arch ${arch}
iseq ${os_arch} x86_64 && set os_arch x86_64 ||
iseq ${os_arch} i386 && set os_arch i686 ||

# Set IP parameters
isset ${dhcp-server} && set ipparam BOOTIF=${netX/mac} ip=dhcp || set ipparam BOOTIF=${netX/mac} ip=${ip}::${gateway}:${netmask}

# Set local server and paths
set server_url http://192.168.0.120:8000
set arch_dir arch
set boot_dir boot

# Boot menu
menu Arch Linux Boot Menu
item --gap Boot Options
item arch_linux Arch Linux (x86_64)
item arch_linux_speech Arch Linux with Speech (x86_64)
item memtest Memtest86+
item --gap Tools
item shell Drop to iPXE shell
item reboot Reboot
choose option || goto exit

# Boot options
:arch_linux
echo Booting Arch Linux (x86_64)...
imgfree
set params archisobasedir=${arch_dir} archiso_http_srv=${server_url}/ ${ipparam} net.ifnames=0
kernel ${server_url}/${arch_dir}/boot/x86_64/vmlinuz-linux ${params}
initrd ${server_url}/${arch_dir}/boot/x86_64/initramfs-linux.img
boot
goto exit

:arch_linux_speech
echo Booting Arch Linux with Speech Support (x86_64)...
imgfree
set params archisobasedir=${arch_dir} archiso_http_srv=${server_url}/ ${ipparam} net.ifnames=0 accessibility=on
kernel ${server_url}/${arch_dir}/boot/x86_64/vmlinuz-linux ${params}
initrd ${server_url}/${arch_dir}/boot/x86_64/initramfs-linux.img
boot
goto exit

:memtest
echo Booting Memtest86+...
chain ${server_url}/${boot_dir}/memtest86+/memtest.efi
goto exit

:shell
echo Dropping to iPXE shell...
shell
goto main_menu

:reboot
reboot

:exit
